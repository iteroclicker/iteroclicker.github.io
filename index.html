<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Emoji Clicker</title>
  <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    html, body { width: 100vw; height: 100vh; margin: 0; padding: 0; overflow: hidden; background: #0a0a0a; touch-action: none; font-family: sans-serif; user-select: none; }
    canvas { display: block; position: fixed; top: 0; left: 0; z-index: 1; width: 100% !important; height: 100% !important; }
    #hud { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    #score_box { position: absolute; top: 10px; right: 14px; text-align: right; }
    #score_val { font-size: clamp(28px, 5vw, 58px); font-weight: 900; color: #fff; line-height: 1; text-shadow: 0 0 20px rgba(255,200,0,.5), 0 2px 8px rgba(0,0,0,.8); transition: color .3s; }
    #score_sub { font-size: clamp(11px, 1.7vw, 14px); color: #888; margin-top: 4px; transition: color .3s; }
    body.light #score_val { color: #1a1a2e; text-shadow: 0 2px 6px rgba(0,0,0,.15); }
    body.light #score_sub { color: #7f8c8d; }
    .hbtn { position: absolute; right: 14px; width: 50px; height: 50px; border-radius: 14px; border: none; cursor: pointer; font-size: 22px; display: flex; align-items: center; justify-content: center; background: rgba(37,37,37,.92); color: #fff; pointer-events: all; transition: background .3s, transform .12s, opacity .3s; box-shadow: 0 2px 12px rgba(0,0,0,.4); }
    .hbtn:active { transform: scale(.88); }
    body.light .hbtn { background: rgba(232,236,240,.95); color: #1a1a2e; }
    #btn_menu { bottom: 166px; }
    #btn_theme { bottom: 106px; }
    #btn_sound { bottom: 46px; }
    #btn_open { position: absolute; top: 14px; width: 50px; height: 50px; border-radius: 14px; border: none; cursor: pointer; font-size: 22px; display: flex; align-items: center; justify-content: center; background: rgba(37,37,37,.95); color: #fff; pointer-events: all; z-index: 20; transition: background .3s, transform .12s, left .3s; box-shadow: 0 2px 14px rgba(0,0,0,.5); }
    #btn_open:active { transform: scale(.88); }
    body.light #btn_open { background: rgba(232,236,240,.95); color: #1a1a2e; }
    #boost_bar { position: absolute; bottom: 14px; left: 50%; transform: translateX(-50%); font-size: 13px; color: #ffd700; font-weight: 900; text-shadow: 0 1px 4px rgba(0,0,0,.8); opacity: 0; transition: opacity .4s; pointer-events: none; white-space: nowrap; }
    /* –ù–∞ –º–µ–ª–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –ø—Ä—è—á–µ–º –±–æ–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–æ */
    @media (max-width: 600px) {
      body.menu-open .hbtn {
        opacity: 0;
        pointer-events: none;
      }
    }
  </style>
</head>
<body>
<div id="hud">
  <div id="score_box">
    <div id="score_val">üí∞ 0</div>
    <div id="score_sub">0/—Å √ó1</div>
  </div>
  <button id="btn_open">‚ò∞</button>
  <button id="btn_menu"  class="hbtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É">üíæ</button>
  <button id="btn_theme" class="hbtn" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
  <button id="btn_sound" class="hbtn" title="–ó–≤—É–∫ –≤–∫–ª/–≤—ã–∫–ª">üîä</button>
  <div id="boost_bar"></div>
</div>
<script>
  // –ó–∞–ø—Ä–µ—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–∏
  document.addEventListener('contextmenu', e => e.preventDefault());

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ó–≤—É–∫–∏ ‚Äî –ø—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è‚Äë–±–∏–ø–µ—Ä
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let a_ctx = null;
  let snd_on = true;
  const beep = (f, t = 'sine', d = 0.12, v = 0.07) => {
    if (!snd_on) return;
    try {
      if (!a_ctx) a_ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = a_ctx.createOscillator();
      const g = a_ctx.createGain();
      o.type = t;
      o.frequency.value = f;
      g.gain.setValueAtTime(v, a_ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001, a_ctx.currentTime + d);
      o.connect(g);
      g.connect(a_ctx.destination);
      o.start();
      o.stop(a_ctx.currentTime + d + 0.01);
    } catch (e) {
      // –µ—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî –º–æ–ª—á–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    }
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –¢—ë–º–Ω–∞—è –∏ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º—ã
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const THEMES = {
    dark: { bg: 0x0a0a0a, txt: 0xffffff, mbg: 0x131318, btn: 0x252530, sub: 0x888888, brd: 0x333340 },
    light: { bg: 0xf0f2f5, txt: 0x1a1a2e, mbg: 0xffffff, btn: 0xe0e4e8, sub: 0x7f8c8d, brd: 0xbbbbcc }
  };
  let col = { ...THEMES.dark };
  let cur_theme = 'dark';
  let prev_theme = 'dark';
  let theme_t = 1;               // –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ (0..1)

  // –õ—ë–≥–∫–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —Ü–≤–µ—Ç–æ–≤
  const lerp_c = (a, b, t) => {
    const r = c => Math.round(((a >> c) & 0xff) + ((((b >> c) & 0xff) - ((a >> c) & 0xff)) * t));
    return (r(16) << 16) | (r(8) << 8) | r(0);
  };

  const apply_theme = th => {
    cur_theme = th;
    document.body.classList.toggle('light', th === 'light');
    document.getElementById('btn_theme').textContent = th === 'dark' ? 'üåô' : 'üåû';
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è (—á—Ç–æ–±—ã –±—ã–ª–æ –∫ —á–µ–º—É —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const ACHIEV = [
    { id: 'c1', icon: 'üñ±Ô∏è', name: '–ü–µ—Ä–≤—ã–π –∫–ª–∏–∫', chk: s => s.t_clicks >= 1 },
    { id: 'c100', icon: 'üíØ', name: '100 –∫–ª–∏–∫–æ–≤', chk: s => s.t_clicks >= 100 },
    { id: 'c1k', icon: 'üèÖ', name: '1000 –∫–ª–∏–∫–æ–≤', chk: s => s.t_clicks >= 1000 },
    { id: 'c10k', icon: 'üéñÔ∏è', name: '10 000 –∫–ª–∏–∫–æ–≤', chk: s => s.t_clicks >= 10000 },
    { id: 'e1k', icon: 'üåü', name: '–¢—ã—Å—è—á–Ω–∏–∫ (–∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ 1k)', chk: s => s.t_earn >= 1e3 },
    { id: 'e1m', icon: 'üí∞', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä', chk: s => s.t_earn >= 1e6 },
    { id: 'e1b', icon: 'üíé', name: '–ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä', chk: s => s.t_earn >= 1e9 },
    { id: 'e1t', icon: 'üëë', name: '–¢—Ä–∏–ª–ª–∏–æ–Ω–µ—Ä', chk: s => s.t_earn >= 1e12 },
    { id: 'buy1', icon: 'üõí', name: '–ü–µ—Ä–≤–∞—è –ø–æ–∫—É–ø–∫–∞', chk: s => Object.values(s.upg).some(u => u.lvl > 0) },
    { id: 'frnz', icon: 'üî•', name: '–í –∫—É—Ä–∞–∂–µ! (8+ –∫–ª–∏–∫–æ–≤/—Å)', chk: s => s.max_cps >= 8 },
    { id: 'a100', icon: 'ü§ñ', name: '–ê–≤—Ç–æ 100/—Å', chk: s => s.auto >= 100 },
    { id: 'a1k', icon: '‚ö°', name: '–ê–≤—Ç–æ 1000/—Å', chk: s => s.auto >= 1000 },
    { id: 'gold', icon: '‚≠ê', name: '–ó–æ–ª–æ—Ç–∞—è —É–¥–∞—á–∞', chk: s => s.g_caught >= 1 },
    { id: 'pres', icon: '‚ôæÔ∏è', name: '–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ', chk: s => s.prest_n >= 1 },
    { id: 'sk6', icon: 'üé®', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä (6 —Å–∫–∏–Ω–æ–≤)', chk: s => s.skins_n >= 6 },
    { id: 'sk16', icon: 'üñºÔ∏è', name: '–ú–∞—Å—Ç–µ—Ä –æ–±–ª–∏–∫–∞ (16 —Å–∫–∏–Ω–æ–≤)', chk: s => s.skins_n >= 16 },
    { id: 'boost', icon: '‚ö°', name: '–ü–µ—Ä–≤—ã–π –±—É—Å—Ç', chk: s => s.boosts_used >= 1 },
    { id: 'crit', icon: 'üí•', name: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π! (50 –∫—Ä–∏—Ç–æ–≤)', chk: s => s.t_crits >= 50 },
  ];

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (state)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const S = {
    score: 0,
    click_pow: 1,
    mult: 1,
    auto: 0,
    crit: 0,                      // —à–∞–Ω—Å –∫—Ä–∏—Ç–∞ (0..0.35)
    t_earn: 0,                    // –≤—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
    t_clicks: 0,                  // –≤—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤
    t_crits: 0,                   // –≤—Å–µ–≥–æ –∫—Ä–∏—Ç–æ–≤
    g_caught: 0,                  // –ø–æ–π–º–∞–Ω–æ –∑–æ–ª–æ—Ç—ã—Ö —É—Ç–æ–∫
    max_cps: 0,                   // —Ä–µ–∫–æ—Ä–¥ –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
    prest_n: 0,                   // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ—Å—Ç–∏–∂–µ–π
    prest_mult: 1,                // –º–Ω–æ–∂–∏—Ç–µ–ª—å –ø—Ä–µ—Å—Ç–∏–∂–∞
    skins_n: 1,                   // —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤ —é–∑–∞–ª–∏
    boosts_used: 0,               // —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–∫–ª—é—á–∞–ª–∏ –±—É—Å—Ç
    boost_ms: 0,                  // —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –±—É—Å—Ç–∞ √ó3 (–º—Å)
    boost_cd: 0,                  // –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –±—É—Å—Ç–∞ (–º—Å)
    boost_dur: 20000,             // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±—É—Å—Ç–∞ 20 —Å–µ–∫—É–Ω–¥
    storm_ms: 0,                  // —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å –±—É—Ä–∏ –∫–ª–∏–∫–æ–≤
    storm_cd: 0,                  // –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ –±—É—Ä–∏
    upg: {
      power: { lvl: 0, base: 20, sc: 1.45, lbl: '–ö–ª–∏–∫ +1', sub: '–°–∏–ª–∞ –∫–ª–∏–∫–∞' },
      auto: { lvl: 0, base: 100, sc: 1.55, lbl: '–ê–≤—Ç–æ +1', sub: '–í —Å–µ–∫—É–Ω–¥—É' },
      pond: { lvl: 0, base: 2000, sc: 1.65, lbl: '–ü—Ä—É–¥ +20', sub: '–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥' },
      farm: { lvl: 0, base: 15000, sc: 1.75, lbl: '–§–µ—Ä–º–∞ +120', sub: '–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ' },
      factory: { lvl: 0, base: 1e5, sc: 1.85, lbl: '–ó–∞–≤–æ–¥ +600', sub: '–ò–Ω–¥—É—Å—Ç—Ä–∏—è' },
      lab: { lvl: 0, base: 8e5, sc: 2.0, lbl: '–õ–∞–±–∞ +3000', sub: '–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥' },
      mult: { lvl: 0, base: 5000, sc: 4.0, lbl: '–ú—É–ª—å—Ç √ó2', sub: '–£–¥–≤–∞–∏–≤–∞–µ—Ç –≤—Å—ë' },
      crit: { lvl: 0, base: 2500, sc: 2.2, lbl: '–ö—Ä–∏—Ç +5%', sub: '–£—Ä–æ–Ω √ó3 (–º–∞–∫—Å 35%)' },
      storm: { lvl: 0, base: 50000, sc: 5.0, lbl: '–ë—É—Ä—è –∫–ª–∏–∫–æ–≤', sub: '–ê–≤—Ç–æ-–∫–ª–∏–∫ 5—Å' },
      luck: { lvl: 0, base: 10000, sc: 3.0, lbl: '–£–¥–∞—á–∞ +10%', sub: '–®–∞–Ω—Å √ó2 –¥—Ä–æ–ø–∞' },
    },
    unlocked: {},                 // –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    cur_tab: 0,                   // –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –º–µ–Ω—é
    menu_open: false,
    menu_w: 350,
    scroll_y: 0,                  // —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (px)
    scroll_tgt: 0,                // —Ü–µ–ª–µ–≤–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    max_scroll: 0,                // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    dk_scale: 1,                  // –º–∞—Å—à—Ç–∞–± —É—Ç–∫–∏ (–¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç—ã–∫–∞)
    dk_rot: 0,                    // –ø–æ–≤–æ—Ä–æ—Ç —É—Ç–∫–∏
    dk_rot_vel: 0,                // —Å–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è
    shake: 0,                     // —Ç—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞ (0..)
    clicks: [],                   // –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤ –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ CPS
    auto_timer: 0,                // –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥–∞
    g_active: false,              // –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∑–æ–ª–æ—Ç–∞—è —É—Ç–∫–∞
    g_ms: 0,                      // —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—à–ª–æ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –∑–æ–ª–æ—Ç–æ–π
    g_next: 45000,                // —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –ø–æ—è–≤–∏—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è (–º—Å)
    last_save: Date.now(),
    luck_mult: 1,                 // –º–Ω–æ–∂–∏—Ç–µ–ª—å —É–¥–∞—á–∏ (–æ—Ç –∞–ø–≥—Ä–µ–π–¥–∞)
  };

  // –û—Ç–¥–µ–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–º –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–∫–∏–Ω—ã (—á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å —Å—á—ë—Ç—á–∏–∫)
  let unlocked_skins = new Set(['ü¶Ü']); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å—Ç—å —É—Ç–∫–∞

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –£—Ç–∏–ª–∏—Ç—ã
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const TIERS = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx'];
  const fmt = n => {
    n = Math.floor(n);
    if (n < 1000) return String(n);
    const i = Math.min(Math.floor(Math.log10(n) / 3), TIERS.length - 1);
    return (n / Math.pow(10, i * 3)).toFixed(1).replace(/\.0$/, '') + TIERS[i];
  };
  const upg_price = u => Math.floor(u.base * Math.pow(u.sc, u.lvl));
  const sec = ms => Math.floor(ms / 1000);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ / –∑–∞–≥—Ä—É–∑–∫–∞
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let loaded_skin = 'ü¶Ü';          // —Å–∫–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const save = () => {
    try {
      localStorage.setItem('ec3', JSON.stringify({
        score: S.score,
        click_pow: S.click_pow,
        mult: S.mult,
        auto: S.auto,
        crit: S.crit,
        t_earn: S.t_earn,
        t_clicks: S.t_clicks,
        t_crits: S.t_crits,
        g_caught: S.g_caught,
        max_cps: S.max_cps,
        prest_n: S.prest_n,
        prest_mult: S.prest_mult,
        skins_n: S.skins_n,
        boosts_used: S.boosts_used,
        luck_mult: S.luck_mult,
        unlocked: S.unlocked,
        theme: cur_theme,
        unlocked_skins: Array.from(unlocked_skins),
        upg: Object.fromEntries(Object.entries(S.upg).map(([k, v]) => [k, { lvl: v.lvl }])),
        dk: duck ? duck.text : 'ü¶Ü',
        ts: Date.now(),
      }));
    } catch (e) { }
  };
  const load = () => {
    try {
      const raw = localStorage.getItem('ec3');
      if (!raw) return;
      const d = JSON.parse(raw);
      ['score', 'click_pow', 'mult', 'auto', 'crit', 't_earn', 't_clicks', 't_crits', 'g_caught',
        'max_cps', 'prest_n', 'prest_mult', 'skins_n', 'boosts_used', 'luck_mult', 'unlocked'
      ].forEach(k => { if (d[k] !== undefined) S[k] = d[k]; });
      if (d.upg) {
        Object.keys(d.upg).forEach(k => { if (S.upg[k]) S.upg[k].lvl = d.upg[k].lvl || 0; });
      }
      if (d.theme) {
        apply_theme(d.theme);
        col = { ...THEMES[d.theme] };
        cur_theme = d.theme;
      }
      if (d.dk) loaded_skin = d.dk;
      if (d.unlocked_skins && Array.isArray(d.unlocked_skins)) {
        unlocked_skins = new Set(d.unlocked_skins);
        S.skins_n = unlocked_skins.size;
      }
      // –û—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥
      if (d.ts && S.auto > 0) {
        const off_s = Math.min((Date.now() - d.ts) / 1000, 3600); // –Ω–µ –±–æ–ª—å—à–µ —á–∞—Å–∞
        const gain = Math.floor(off_s * S.auto * S.mult);
        if (gain > 0) {
          S.score += gain;
          S.t_earn += gain;
          off_gain = gain;
        }
      }
    } catch (e) { }
  };
  let off_gain = 0;
  setInterval(save, 30000);
  window.addEventListener('beforeunload', save);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  PIXI ‚Äì —Å—Ü–µ–Ω–∞, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const app = new PIXI.Application({
    backgroundColor: 0x0a0a0a,
    antialias: true,
    autoDensity: true,
    resolution: window.devicePixelRatio || 1
  });
  document.body.insertBefore(app.view, document.getElementById('hud'));

  const bg_layer = new PIXI.Container();      // –ø–ª–∞–≤–∞—é—â–∏–µ —ç–º–æ–¥–∑–∏ –Ω–∞ –∑–∞–¥–Ω–µ–º –ø–ª–∞–Ω–µ
  const world = new PIXI.Container();         // –æ—Å–Ω–æ–≤–Ω–æ–π –º–∏—Ä: —É—Ç–∫–∞, –∫–ª–∏–∫–∏, –∏—Å–∫—Ä—ã
  const menu_cont = new PIXI.Container();     // —Å–∞–º–æ –º–µ–Ω—é (—Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
  const ui_layer = new PIXI.Container();      // –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π (—Ç–æ—Å—Ç—ã, –∫–æ–º–±–æ)
  const sc = new PIXI.Container();            // –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
  const mask_g = new PIXI.Graphics();         // –º–∞—Å–∫–∞ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
  const sbar_g = new PIXI.Graphics();         // –ø–æ–ª–æ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
  const menu_bg = new PIXI.Graphics();        // —Ñ–æ–Ω –º–µ–Ω—é
  const click_area = new PIXI.Graphics();     // –Ω–µ–≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è –∫–ª–∏–∫–æ–≤

  menu_bg.eventMode = 'static';
  mask_g.eventMode = 'none';
  click_area.eventMode = 'static';
  click_area.cursor = 'pointer';

  app.stage.addChild(bg_layer, world, menu_cont, ui_layer);
  menu_cont.addChild(menu_bg, sc, mask_g, sbar_g);
  sc.mask = mask_g;
  world.addChild(click_area);

  // –ì–ª–∞–≤–Ω–∞—è —É—Ç–∫–∞ (—ç–º–æ–¥–∑–∏)
  const duck = new PIXI.Text('ü¶Ü', { fontSize: 160 });
  duck.anchor.set(0.5);
  world.addChild(duck);

  // –ó–æ–ª–æ—Ç–∞—è —É—Ç–∫–∞
  const g_duck = new PIXI.Text('‚≠ê', { fontSize: 64 });
  g_duck.anchor.set(0.5);
  g_duck.visible = false;
  g_duck.eventMode = 'static';
  g_duck.cursor = 'pointer';
  world.addChild(g_duck);

  // –ö–æ–º–±–æ‚Äë—Å—á—ë—Ç—á–∏–∫ –≤–≤–µ—Ä—Ö—É
  const combo_lbl = new PIXI.Text('', { fontSize: 40, fill: 0xffa500, fontWeight: '900', strokeThickness: 5, stroke: 0 });
  combo_lbl.anchor.set(0.5);
  combo_lbl.visible = false;
  ui_layer.addChild(combo_lbl);

  // –°–ª–æ–π –¥–ª—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç–æ—Å—Ç—ã)
  const toast_layer = new PIXI.Container();
  ui_layer.addChild(toast_layer);
  const toasts = [];
  const show_toast = txt => {
    const t = new PIXI.Text(txt, { fontSize: 18, fill: 0xffffff, fontWeight: '900', stroke: 0x000000, strokeThickness: 5, align: 'center' });
    t.anchor.set(0.5);
    t.position.set(app.screen.width / 2, app.screen.height * 0.80 - toasts.length * 44);
    t.alpha = 0;
    t.ttl = 3.0;
    toast_layer.addChild(t);
    toasts.push(t);
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ü–ª–∞–≤–∞—é—â–∏–µ —Ñ–æ–Ω–æ–≤—ã–µ —ç–º–æ–¥–∑–∏
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const BG_EM = ['ü¶Ü', 'üí∞', '‚≠ê', 'üíé', 'üéÆ', '‚ú®', 'üèÜ', 'üéØ', 'üé≤', 'üåü', 'üöÄ', 'üéà', 'üçÄ', 'üé™', 'ü¶ã', 'üåà'];
  const floaters = [];
  const spawn_floater = (start_y) => {
    const t = new PIXI.Text(BG_EM[Math.floor(Math.random() * BG_EM.length)], { fontSize: 50 + Math.random() * 90 });
    t.anchor.set(0.5);
    t.x = Math.random() * app.screen.width;
    t.y = start_y !== undefined ? start_y : app.screen.height + 80;
    t.alpha = cur_theme === 'light' ? 0.12 + Math.random() * 0.12 : 0.05 + Math.random() * 0.10;
    t.vx = (Math.random() - 0.5) * 0.35;
    t.vy = -(0.2 + Math.random() * 0.45);
    t.rot_v = (Math.random() - 0.5) * 0.003;
    bg_layer.addChild(t);
    floaters.push(t);
  };
  for (let i = 0; i < 16; i++) spawn_floater(Math.random() * 2200);

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ú–µ–Ω—é: —Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const MENU_TOP = 80;
  const TAB_NAMES = ['üõí –ú–∞–≥–∞–∑–∏–Ω', 'üé® –°–∫–∏–Ω—ã', 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'üëæ –û–± –∏–≥—Ä–µ'];
  const TAB_W = () => S.menu_w / TAB_NAMES.length;

  // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é
  const mhdr_bg = new PIXI.Graphics();
  const mhdr_lbl = new PIXI.Text('EMOJI CLICKER', { fontSize: 15, fontWeight: '900', fill: 0xffffff });
  const tab_btns = [];
  menu_cont.addChild(mhdr_bg);
  menu_cont.addChild(mhdr_lbl);
  TAB_NAMES.forEach((nm, i) => {
    const c = new PIXI.Container();
    c.eventMode = 'static';
    c.cursor = 'pointer';
    const bg = new PIXI.Graphics();
    const t = new PIXI.Text(nm, { fontSize: 11, fontWeight: 'bold', align: 'center' });
    t.anchor.set(0.5);
    c.addChild(bg, t);
    menu_cont.addChild(c);
    c.on('pointerdown', e => { e.stopPropagation(); S.cur_tab = i; layout(); });
    tab_btns.push({ c, bg, t });
  });

  // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏ (–≤–Ω—É—Ç—Ä–∏ sc)
  const tab_contents = [new PIXI.Container(), new PIXI.Container(), new PIXI.Container(), new PIXI.Container()];
  tab_contents.forEach(tc => sc.addChild(tc));

  // –í–∫–ª–∞–¥–∫–∞ 0: –º–∞–≥–∞–∑–∏–Ω
  const shop_btns = [];
  let prestige_row;
  const init_shop = () => {
    Object.keys(S.upg).forEach(id => {
      const c = new PIXI.Container();
      c.eventMode = 'static';
      c.cursor = 'pointer';
      const bg = new PIXI.Graphics();
      const t = new PIXI.Text('', { fontSize: 14, fontWeight: 'bold' });
      const d = new PIXI.Text('', { fontSize: 10 });
      const p = new PIXI.Text('', { fontSize: 13, fontWeight: 'bold' });
      t.position.set(10, 7);
      d.position.set(10, 31);
      c.addChild(bg, t, d, p);
      tab_contents[0].addChild(c);
      c.on('pointerdown', e => { e.stopPropagation(); buy(id); });
      shop_btns.push({ id, c, bg, t, d, p });
    });

    // –°—Ç—Ä–æ–∫–∞ –ø—Ä–µ—Å—Ç–∏–∂–∞
    prestige_row = new PIXI.Container();
    prestige_row.eventMode = 'static';
    prestige_row.cursor = 'pointer';
    const prBg = new PIXI.Graphics();
    const prT = new PIXI.Text('‚ú® –ü–†–ï–°–¢–ò–ñ', { fontSize: 14, fontWeight: '900', fill: 0xffd700 });
    const prD = new PIXI.Text('', { fontSize: 10, fill: 0xaaaaaa });
    prT.position.set(10, 7);
    prD.position.set(10, 29);
    prestige_row.addChild(prBg, prT, prD);
    tab_contents[0].addChild(prestige_row);
    prestige_row._bg = prBg;
    prestige_row._d = prD;
    prestige_row.on('pointerdown', e => { e.stopPropagation(); do_prestige(); });

    // –ö–Ω–æ–ø–∫–∞ –±—É—Å—Ç–∞
    const bst = new PIXI.Container();
    bst.eventMode = 'static';
    bst.cursor = 'pointer';
    const bBg = new PIXI.Graphics();
    const bT = new PIXI.Text('‚ö° –ë–£–°–¢ √ó3 (20—Å)', { fontSize: 14, fontWeight: '900', fill: 0x00ccff });
    const bD = new PIXI.Text('–£—Ç—Ä–æ–∏—Ç—å –¥–æ—Ö–æ–¥ –Ω–∞ 20 —Å–µ–∫—É–Ω–¥', { fontSize: 10, fill: 0xaaaaaa });
    bT.position.set(10, 7);
    bD.position.set(10, 29);
    bst.addChild(bBg, bT, bD);
    tab_contents[0].addChild(bst);
    bst._bg = bBg;
    bst._lbl = bT;
    bst.on('pointerdown', e => { e.stopPropagation(); use_boost(); });
    shop_btns._boost = bst;
  };

  // –í–∫–ª–∞–¥–∫–∞ 1: —Å–∫–∏–Ω—ã
  const SKINS = [
    'ü¶Ü', 'üëΩ', 'üéÉ', 'ü•∂', 'üí©', 'üçî', 'üíé', 'üóø', 'ü•ë', 'ü¶ñ', 'üöÄ', 'ü¶Ñ', 'üî•', 'üëë', 'üéà', 'üßä',
    'üê∏', 'ü§°', 'üëª', 'ü¶Ä', 'üêô', 'ü¶ë', 'üåµ', 'üçÑ', 'üê≤', 'ü¶Å', 'üêØ', 'ü¶ä', 'üê∫', 'ü¶ù', 'ü§†',
    'üßô', 'üßü', 'üßõ', 'ü§ñ', 'üëæ', 'üé≠', 'üåÄ', 'üíÄ', 'üåô', '‚òÄÔ∏è', 'üçï', 'üç£', 'üßÉ', 'üé∏', 'ü™ê'
  ];
  const skin_btns = [];
  const init_skins = () => {
    SKINS.forEach(em => {
      const b = new PIXI.Container();
      b.eventMode = 'static';
      b.cursor = 'pointer';
      const bg = new PIXI.Graphics();
      const t = new PIXI.Text(em, { fontSize: 26 });
      t.anchor.set(0.5);
      b.addChild(bg, t);
      b.on('pointerdown', ev => {
        ev.stopPropagation();
        duck.text = em;
        S.shake = 5;
        if (!unlocked_skins.has(em)) {
          unlocked_skins.add(em);
          S.skins_n = unlocked_skins.size;
        }
        check_ach();
        update_ui();
      });
      tab_contents[1].addChild(b);
      skin_btns.push({ b, bg, t });
    });
  };

  // –í–∫–ª–∞–¥–∫–∞ 2: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  let stats_txt;
  const init_stats = () => {
    stats_txt = new PIXI.Text('', { fontSize: 13, fill: 0xaaaaaa, lineHeight: 22, wordWrap: true });
    stats_txt.position.set(14, 10);
    tab_contents[2].addChild(stats_txt);
  };

  // –í–∫–ª–∞–¥–∫–∞ 3: –æ–± –∏–≥—Ä–µ
  const init_about = () => {
    const lines = [
      { txt: 'üëæ', sz: 72, fill: 0xffffff },
      { txt: 'redeflesq', sz: 28, fill: 0x00ccff },
      { txt: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏–≥—Ä—ã', sz: 14, fill: 0x888888 },
      { txt: 'v3.0  2025', sz: 12, fill: 0x444455 },
      { txt: '', sz: 12, fill: 0x444455 },
      { txt: '–°–æ–≤–µ—Ç—ã:', sz: 15, fill: 0xffd700 },
      { txt: '‚Ä¢ –ñ–º–∏ –±—ã—Å—Ç—Ä–æ ‚Äî FRENZY x2!', sz: 12, fill: 0x888888 },
      { txt: '‚Ä¢ –õ–æ–≤–∏ ‚≠ê ‚Äî –±–æ–Ω—É—Å 10% —Å—á—ë—Ç–∞', sz: 12, fill: 0x888888 },
      { txt: '‚Ä¢ –ü—Ä–µ—Å—Ç–∏–∂ –¥–∞—ë—Ç x1.5 –Ω–∞–≤—Å–µ–≥–¥–∞', sz: 12, fill: 0x888888 },
      { txt: '‚Ä¢ –ë—É—Å—Ç √ó3 —Å—Ç–æ–∏—Ç –¥—ë—à–µ–≤–æ ‚Äî —é–∑–∞–π!', sz: 12, fill: 0x888888 },
      { txt: '‚Ä¢ –õ–∞–±–∞ ‚Äî –ª—É—á—à–∏–π –∞–≤—Ç–æ –≤ –∏–≥—Ä–µ', sz: 12, fill: 0x888888 },
    ];
    let y = 20;
    lines.forEach(l => {
      const t = new PIXI.Text(l.txt, { fontSize: l.sz, fill: l.fill, fontWeight: 'bold', align: 'center' });
      t.anchor.set(0.5, 0);
      t.x = S.menu_w / 2;
      t.y = y;
      tab_contents[3].addChild(t);
      y += l.sz + 10;
    });
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const buy = id => {
    const u = S.upg[id];
    const price = upg_price(u);
    if (S.score < price || (id === 'crit' && S.crit >= 0.35)) return;
    S.score -= price;
    u.lvl++;
    if (id === 'power') S.click_pow++;
    else if (id === 'auto') S.auto++;
    else if (id === 'pond') S.auto += 20;
    else if (id === 'farm') S.auto += 120;
    else if (id === 'factory') S.auto += 600;
    else if (id === 'lab') S.auto += 3000;
    else if (id === 'mult') S.mult *= 2;
    else if (id === 'crit') S.crit = Math.min(0.35, S.crit + 0.05);
    else if (id === 'storm') { /* –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è */ }
    else if (id === 'luck') S.luck_mult = 1 + u.lvl * 0.1;
    beep(523, 'sine', 0.14, 0.08);
    check_ach();
    update_ui();
  };

  const use_boost = () => {
    if (S.boost_ms > 0 || S.boost_cd > 0) return;
    const cost = Math.floor(Math.max(1000, S.auto * S.mult * 5));
    if (S.score < cost) return;
    S.score -= cost;
    S.boost_ms = S.boost_dur;
    S.boost_cd = 90000;         // 90 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞
    S.boosts_used++;
    beep(880, 'sine', 0.3, 0.12);
    show_toast('‚ö° –ë–£–°–¢ –ê–ö–¢–ò–í–ï–ù 20—Å!');
    check_ach();
    update_ui();
  };

  const do_storm = () => {
    if (S.upg.storm.lvl === 0 || S.storm_cd > 0 || S.storm_ms > 0) return;
    S.storm_ms = 5000;          // 5 —Å–µ–∫—É–Ω–¥
    S.storm_cd = 60000;         // –º–∏–Ω—É—Ç–∞ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞
    storm_acc = 0;
    beep(660, 'square', 0.2, 0.1);
    show_toast('üå™Ô∏è –ë–£–†–Ø –ö–õ–ò–ö–û–í 5—Å!');
  };

  const do_prestige = () => {
    if (S.t_earn < 1e9) return;
    S.prest_n++;
    S.prest_mult = 1 + S.prest_n * 0.5;   // +50% –∑–∞ –∫–∞–∂–¥—ã–π –ø—Ä–µ—Å—Ç–∏–∂
    const keep = { ...S.unlocked };
    const sk = S.skins_n;
    S.score = 0;
    S.click_pow = 1;
    S.mult = S.prest_mult;
    S.auto = 0;
    S.crit = 0;
    S.luck_mult = 1;
    S.t_earn = 0;
    S.t_clicks = 0;
    S.max_cps = 0;
    S.g_caught = 0;
    S.t_crits = 0;
    Object.values(S.upg).forEach(u => u.lvl = 0);
    S.unlocked = keep;
    S.skins_n = sk;
    beep(880, 'sine', 0.7, 0.15);
    show_toast('‚ú® –ü—Ä–µ—Å—Ç–∏–∂! x' + S.prest_mult.toFixed(1) + ' –Ω–∞–≤—Å–µ–≥–¥–∞!');
    update_ui();
  };

  const check_ach = () => {
    ACHIEV.forEach(a => {
      if (!S.unlocked[a.id] && a.chk(S)) {
        S.unlocked[a.id] = true;
        show_toast(a.icon + ' ' + a.name + '!');
        beep(660, 'sine', 0.4, 0.1);
      }
    });
  };

  // –ó–æ–ª–æ—Ç–∞—è —É—Ç–∫–∞
  g_duck.on('pointerdown', e => {
    e.stopPropagation();
    if (!S.g_active) return;
    const b = Math.max(200, Math.floor(S.score * 0.1 + S.click_pow * S.mult * 200));
    S.score += b;
    S.t_earn += b;
    S.g_caught++;
    S.g_active = false;
    g_duck.visible = false;
    S.shake = 18;
    beep(1200, 'sine', 0.5, 0.18);
    spawn_pop('+' + fmt(b) + '!', g_duck.x, g_duck.y, 0xffd700, 54);
    check_ach();
    update_ui();
  });

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —É—Ç–∫–µ (–∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞)
  const pops = [];
  const sparks = [];
  click_area.on('pointerdown', e => {
    if (S.menu_open && e.global.x < S.menu_w) return; // –∫–ª–∏–∫ –ø–æ –º–µ–Ω—é –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è
    const now = Date.now();
    S.clicks.push(now);
    S.t_clicks++;
    const cps = S.clicks.length;
    S.max_cps = Math.max(S.max_cps, cps);
    const frenzy = cps >= 8;
    const is_crit = Math.random() < S.crit;
    if (is_crit) S.t_crits++;
    const boost_m = S.boost_ms > 0 ? 3 : 1;
    const luck_m = (Math.random() < 0.1 * (S.luck_mult - 1 + 1)) ? S.luck_mult : 1; // —à–∞–Ω—Å √ó10% √ó —É—Ä–æ–≤–µ–Ω—å
    const v = Math.floor(S.click_pow * S.mult * (is_crit ? 3 : 1) * (frenzy ? 2 : 1) * boost_m * luck_m);
    S.score += v;
    S.t_earn += v;
    S.dk_scale = 0.80;            // —ç—Ñ—Ñ–µ–∫—Ç —Å–∂–∞—Ç–∏—è
    S.shake = is_crit ? 14 : (frenzy ? 8 : 4);
    const amp = 0.10 + cps * 0.028 + (is_crit ? 0.18 : 0);
    S.dk_rot_vel += (Math.random() > 0.5 ? 1 : -1) * amp;
    S.dk_rot_vel = Math.max(-1.5, Math.min(1.5, S.dk_rot_vel));
    beep(is_crit ? 1100 : 780, is_crit ? 'square' : 'sine', is_crit ? 0.18 : 0.07, 0.06);
    let lbl = '+' + fmt(v);
    if (is_crit) lbl += 'üí•';
    if (luck_m > 1) lbl += 'üçÄ';
    spawn_pop(lbl, e.global.x, e.global.y, frenzy ? 0xff3333 : (is_crit ? 0xff8800 : 0xffcc00), is_crit ? 50 : 32);
    const ns = frenzy ? 5 : (is_crit ? 3 : 1);
    for (let i = 0; i < ns; i++) spawn_spark();
    check_ach();
    update_ui();
  });

  const spawn_pop = (txt, x, y, fill, size) => {
    const p = new PIXI.Text(txt, { fontSize: size, fill, fontWeight: '900', strokeThickness: 4, stroke: 0 });
    p.position.set(x, y);
    p.anchor.set(0.5);
    p.l = 1;
    p.vy = -5;
    p.vx = (Math.random() - 0.5) * 4;
    world.addChild(p);
    pops.push(p);
  };
  const SPARK_EM = ['‚ú®', 'üí´', '‚≠ê', 'üåü', 'üí•'];
  const spawn_spark = () => {
    const s = new PIXI.Text(SPARK_EM[Math.floor(Math.random() * SPARK_EM.length)], { fontSize: 16 + Math.random() * 12 });
    s.position.set(duck.x + (Math.random() - 0.5) * 140, duck.y + (Math.random() - 0.5) * 140);
    s.vx = (Math.random() - 0.5) * 18;
    s.vy = (Math.random() - 0.5) * 14 - 7;
    s.l = 1;
    world.addChild(s);
    sparks.push(s);
  };

  // –ë—É—Ä—è –∫–ª–∏–∫–æ–≤ (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å)
  let storm_acc = 0;

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (—Ç–µ–∫—Å—Ç, –∫–Ω–æ–ø–∫–∏)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const update_ui = () => {
    document.getElementById('score_val').textContent = 'üí∞ ' + fmt(S.score);
    const ps = Math.floor(S.auto * S.mult * (S.boost_ms > 0 ? 3 : 1));
    let sub = fmt(ps) + '/—Å √ó' + (Number.isInteger(S.mult) ? S.mult : S.mult.toFixed(1));
    if (S.prest_n > 0) sub += ' ‚ú®' + S.prest_n;
    document.getElementById('score_sub').textContent = sub;

    // –ü–ª–∞–Ω–∫–∞ –±—É—Å—Ç–∞
    const bbar = document.getElementById('boost_bar');
    if (S.boost_ms > 0) {
      bbar.style.opacity = '1';
      bbar.textContent = '‚ö° –ë–£–°–¢ √ó3  ' + sec(S.boost_ms) + '—Å';
    } else if (S.storm_ms > 0) {
      bbar.style.opacity = '1';
      bbar.textContent = 'üå™Ô∏è –ë–£–†–Ø  ' + sec(S.storm_ms) + '—Å';
    } else {
      bbar.style.opacity = '0';
    }

    // –ö–Ω–æ–ø–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
    shop_btns.forEach(s => {
      const u = S.upg[s.id];
      const is_max = s.id === 'crit' && S.crit >= 0.35;
      const price = upg_price(u);
      const can = S.score >= price && !is_max;
      s.t.text = u.lbl + '  [' + u.lvl + ']';
      s.t.style.fill = col.txt;
      s.d.text = is_max ? 'MAX' : u.sub;
      s.d.style.fill = col.sub;
      s.p.text = is_max ? '' : (fmt(price) + ' üí∞');
      s.p.style.fill = can ? 0x2ecc71 : 0xe74c3c;
      s.p.position.set(S.menu_w - s.p.width - 38, 18);
      s.bg.clear().beginFill(col.btn).lineStyle(2, can ? 0x2ecc71 : col.brd).drawRoundedRect(0, 0, S.menu_w - 26, 54, 11);
    });
    // –ö–Ω–æ–ø–∫–∞ –±—É—Å—Ç–∞
    if (shop_btns._boost) {
      const bst = shop_btns._boost;
      const cd = S.boost_cd > 0;
      const cost = Math.floor(Math.max(1000, S.auto * S.mult * 5));
      const can = !cd && S.score >= cost && S.boost_ms <= 0;
      bst._lbl.text = S.boost_ms > 0 ? '‚ö° –ê–ö–¢–ò–í–ï–ù ' + sec(S.boost_ms) + '—Å' : (cd ? '‚è≥ –ö–î ' + sec(S.boost_cd) + '—Å' : '‚ö° –ë–£–°–¢ √ó3 (' + fmt(cost) + ' üí∞)');
      bst._bg.clear().beginFill(col.btn).lineStyle(2, can ? 0x00ccff : col.brd).drawRoundedRect(0, 0, S.menu_w - 26, 54, 11);
    }

    // –ü—Ä–µ—Å—Ç–∏–∂
    if (prestige_row) {
      const can_p = S.t_earn >= 1e9;
      prestige_row.visible = can_p || S.prest_n > 0;
      if (prestige_row.visible) {
        const nm = (1 + (S.prest_n + 1) * 0.5).toFixed(1);
        prestige_row._d.text = can_p ? '–°–±—Ä–æ—Å ‚Üí x' + nm + ' –Ω–∞–≤—Å–µ–≥–¥–∞!' : '–ù—É–∂–Ω–æ 1B (' + fmt(S.t_earn) + ')';
        prestige_row._bg.clear().beginFill(can_p ? 0x2e2000 : col.btn).lineStyle(2, can_p ? 0xffd700 : col.brd).drawRoundedRect(0, 0, S.menu_w - 26, 52, 11);
      }
    }

    // –°–∫–∏–Ω—ã
    const bs = (S.menu_w - 60) / 5;
    skin_btns.forEach(e => {
      const active = e.t.text === duck.text;
      e.bg.clear().beginFill(active ? 0x1a3a5c : col.btn).lineStyle(2, active ? 0x3498db : col.brd).drawRoundedRect(0, 0, bs, bs, 11);
    });

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    if (stats_txt) {
      const total_auto = Math.floor(S.auto * S.mult);
      stats_txt.text = [
        'üí∞ –°—á—ë—Ç: ' + fmt(S.score),
        'üìà –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –≤—Å–µ–≥–æ: ' + fmt(S.t_earn),
        'üñ±Ô∏è –ö–ª–∏–∫–æ–≤: ' + fmt(S.t_clicks),
        'üí• –ö—Ä–∏—Ç–æ–≤: ' + fmt(S.t_crits),
        '‚ö° –ê–≤—Ç–æ/—Å–µ–∫: ' + fmt(total_auto),
        'üî• –ú–∞–∫—Å CPS: ' + S.max_cps,
        '‚≠ê –ó–æ–ª–æ—Ç—ã—Ö —É—Ç–æ–∫: ' + S.g_caught,
        '‚ôæÔ∏è –ü—Ä–µ—Å—Ç–∏–∂–µ–π: ' + S.prest_n,
        'üé® –°–∫–∏–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ' + S.skins_n,
        '‚ö° –ë—É—Å—Ç–æ–≤: ' + S.boosts_used,
        'üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π: ' + Object.keys(S.unlocked).length + '/' + ACHIEV.length,
        '',
        'üîì –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:',
        ...ACHIEV.map(a => (S.unlocked[a.id] ? '‚úÖ' : 'üîí') + ' ' + a.icon + ' ' + a.name),
      ].join('\n');
      stats_txt.style.fill = col.sub;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –≤ —Ç–µ–º–µ
    app.renderer.background.color = col.bg;
    mhdr_lbl.style.fill = col.txt;
    mhdr_bg.clear().beginFill(col.mbg).drawRect(0, 0, S.menu_w, MENU_TOP);
    mhdr_bg.lineStyle(1, col.brd).moveTo(0, MENU_TOP - 1).lineTo(S.menu_w, MENU_TOP - 1);
    menu_bg.clear().beginFill(col.mbg).drawRect(0, MENU_TOP, S.menu_w, app.screen.height - MENU_TOP);

    // –í–∫–ª–∞–¥–∫–∏
    const tw = TAB_W();
    tab_btns.forEach(({ c, bg, t }, i) => {
      const active = i === S.cur_tab;
      bg.clear().beginFill(active ? 0x1a2a3a : col.btn).lineStyle(1, active ? 0x3498db : col.brd).drawRoundedRect(0, 0, tw - 6, 34, 8);
      t.style.fill = active ? 0x3498db : col.sub;
    });

    // –ü–æ–¥–ø—Ä–∞–≤–ª—è–µ–º –∞–ª—å—Ñ—É —Ñ–ª–æ–∞—Ç–µ—Ä–æ–≤ –ø–æ–¥ —Ç–µ–º—É
    floaters.forEach(f => {
      const base = cur_theme === 'light' ? 0.12 : 0.05;
      if (f.alpha < base - 0.02 || f.alpha > base + 0.14) f.alpha = base + Math.random() * 0.10;
    });
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –†–∞—Å–∫–ª–∞–¥–∫–∞ (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const layout = () => {
    const w = window.innerWidth;
    const h = window.innerHeight;
    app.renderer.resize(w, h);
    const mob = w < 600;
    S.menu_w = mob ? Math.floor(w * 0.90) : 370;

    document.body.classList.toggle('menu-open', S.menu_open);

    const btn_open = document.getElementById('btn_open');
    btn_open.style.left = (S.menu_open ? Math.round(menu_cont.x + S.menu_w + 8) : 14) + 'px';

    click_area.clear().beginFill(0, 0.001).drawRect(0, 0, w, h);
    mask_g.clear().beginFill(0).drawRect(0, MENU_TOP, S.menu_w, h - MENU_TOP);

    const cx = (S.menu_open && !mob) ? S.menu_w + (w - S.menu_w) / 2 : w / 2;
    duck.position.set(cx, h / 2);
    combo_lbl.position.set(cx, h * 0.12);
    duck.style.fontSize = Math.min(w - (S.menu_open ? S.menu_w : 0), h) * 0.38;

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é
    mhdr_bg.clear().beginFill(col.mbg).drawRect(0, 0, S.menu_w, MENU_TOP);
    mhdr_bg.lineStyle(1, col.brd).moveTo(0, MENU_TOP - 1).lineTo(S.menu_w, MENU_TOP - 1);
    mhdr_lbl.position.set(14, 10);

    const tw = TAB_W();
    const ty = 38;
    tab_btns.forEach(({ c, bg, t }, i) => {
      c.position.set(i * tw + 3, ty);
      bg.clear().beginFill(i === S.cur_tab ? 0x1a2a3a : col.btn).lineStyle(1, i === S.cur_tab ? 0x3498db : col.brd).drawRoundedRect(0, 0, tw - 6, 34, 8);
      t.position.set((tw - 6) / 2, 17);
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
    tab_contents.forEach((tc, i) => tc.visible = i === S.cur_tab);

    let y0 = 10;

    // –í–∫–ª–∞–¥–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞
    {
      let y = y0;
      shop_btns.forEach(s => { s.c.position.set(13, y); y += 63; });
      if (prestige_row) { prestige_row.position.set(13, y); y += 62; }
      if (shop_btns._boost) { shop_btns._boost.position.set(13, y); y += 62; }
      tab_contents[0]._h = y + 20;
    }

    // –í–∫–ª–∞–¥–∫–∞ —Å–∫–∏–Ω–æ–≤
    {
      const bs = (S.menu_w - 60) / 5;
      skin_btns.forEach((e, i) => {
        e.b.position.set(14 + (i % 5) * (bs + 8), y0 + Math.floor(i / 5) * (bs + 8));
        e.t.position.set(bs / 2, bs / 2);
        e.t.style.fontSize = bs * 0.50;
        e.bg.clear().beginFill(e.t.text === duck.text ? 0x1a3a5c : col.btn).lineStyle(2, e.t.text === duck.text ? 0x3498db : col.brd).drawRoundedRect(0, 0, bs, bs, 11);
      });
      tab_contents[1]._h = y0 + Math.ceil(SKINS.length / 5) * (bs + 8) + 20;
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    if (stats_txt) { stats_txt.style.wordWrapWidth = S.menu_w - 28; tab_contents[2]._h = stats_txt.height + 30; }

    // –í–∫–ª–∞–¥–∫–∞ About
    const about_items = tab_contents[3].children;
    let ay = 20;
    about_items.forEach(t => { t.x = S.menu_w / 2; t.y = ay; ay += t.height + 10; });
    tab_contents[3]._h = ay + 20;

    const vis_h = h - MENU_TOP;
    const cur_h = tab_contents[S.cur_tab]._h || 400;
    S.max_scroll = Math.min(0, vis_h - cur_h);
    update_ui();
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ü–æ–ª–æ—Å–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const draw_sbar = () => {
    sbar_g.clear();
    if (!S.menu_open || S.max_scroll >= 0) { sbar_g.visible = false; return; }
    sbar_g.visible = true;
    const h = app.screen.height;
    const vis_h = h - MENU_TOP;
    const bar_h = Math.max(36, (vis_h / (vis_h - S.max_scroll)) * vis_h);
    const pct = S.max_scroll < 0 ? S.scroll_y / S.max_scroll : 0;
    const bar_y = MENU_TOP + pct * (vis_h - bar_h);
    sbar_g.beginFill(0x666666, 0.6).drawRoundedRect(S.menu_w - 7, bar_y, 4, bar_h, 2);
  };

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (–º—ã—à—å/–ø–∞–ª–µ—Ü)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let drag_active = false;
  let drag_y0 = 0;
  menu_bg.on('pointerdown', e => { drag_active = true; drag_y0 = e.global.y; e.stopPropagation(); });
  window.addEventListener('pointerup', () => drag_active = false);
  window.addEventListener('pointermove', e => {
    if (drag_active && S.menu_open) {
      S.scroll_tgt += (e.clientY - drag_y0) * 1.2;
      drag_y0 = e.clientY;
    }
  });
  app.view.addEventListener('wheel', e => {
    if (S.menu_open && e.clientX < S.menu_w) S.scroll_tgt -= e.deltaY;
  }, { passive: true });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ HTML‚Äë–∫–Ω–æ–ø–æ–∫
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.getElementById('btn_open').addEventListener('pointerdown', e => {
    e.stopPropagation();
    S.menu_open = !S.menu_open;
    layout();
  });
  document.getElementById('btn_menu').addEventListener('pointerdown', e => {
    e.stopPropagation();
    save();
    show_toast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
  });
  document.getElementById('btn_theme').addEventListener('pointerdown', e => {
    e.stopPropagation();
    prev_theme = cur_theme;
    theme_t = 0;
    apply_theme(cur_theme === 'dark' ? 'light' : 'dark');
  });
  document.getElementById('btn_sound').addEventListener('pointerdown', e => {
    e.stopPropagation();
    snd_on = !snd_on;
    document.getElementById('btn_sound').textContent = snd_on ? 'üîä' : 'üîá';
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (ticker)
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  app.ticker.add(delta => {
    const now = Date.now();
    const dt = delta / 60;

    // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ —Ç–µ–º—ã
    if (theme_t < 1) {
      theme_t = Math.min(1, theme_t + 0.05 * delta);
      const c1 = THEMES[prev_theme];
      const c2 = THEMES[cur_theme];
      col = {
        bg: lerp_c(c1.bg, c2.bg, theme_t),
        txt: lerp_c(c1.txt, c2.txt, theme_t),
        mbg: lerp_c(c1.mbg, c2.mbg, theme_t),
        btn: lerp_c(c1.btn, c2.btn, theme_t),
        sub: lerp_c(c1.sub, c2.sub, theme_t),
        brd: lerp_c(c1.brd, c2.brd, theme_t),
      };
      update_ui();
    }

    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞
    S.scroll_tgt = Math.max(S.max_scroll, Math.min(0, S.scroll_tgt));
    S.scroll_y += (S.scroll_tgt - S.scroll_y) * 0.2 * delta;
    sc.y = Math.round(S.scroll_y) + MENU_TOP;
    draw_sbar();

    // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–∫–æ–≤ (–¥–ª—è CPS)
    S.clicks = S.clicks.filter(t => now - t < 1000);
    const cps = S.clicks.length;

    // –¢–∞–π–º–µ—Ä—ã –±—É—Å—Ç–æ–≤ –∏ –±—É—Ä–∏
    const ms = app.ticker.deltaMS;
    if (S.boost_ms > 0) S.boost_ms = Math.max(0, S.boost_ms - ms);
    if (S.boost_cd > 0) S.boost_cd = Math.max(0, S.boost_cd - ms);
    if (S.storm_ms > 0) S.storm_ms = Math.max(0, S.storm_ms - ms);
    if (S.storm_cd > 0) S.storm_cd = Math.max(0, S.storm_cd - ms);

    // –ë—É—Ä—è –∫–ª–∏–∫–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∏–∫–∏ –∫–∞–∂–¥—ã–µ 100 –º—Å)
    if (S.storm_ms > 0) {
      storm_acc += ms;
      while (storm_acc >= 100) {
        storm_acc -= 100;
        const v = Math.floor(S.click_pow * S.mult * (S.boost_ms > 0 ? 3 : 1));
        S.score += v;
        S.t_earn += v;
        spawn_pop('+' + fmt(v), duck.x + (Math.random() - 0.5) * 80, duck.y + (Math.random() - 0.5) * 80, 0x00ccff, 24);
        spawn_spark();
      }
      update_ui();
    }

    // –ê–≤—Ç–æ‚Äë–¥–æ—Ö–æ–¥
    S.auto_timer += ms;
    if (S.auto_timer >= 1000 && S.auto > 0) {
      S.auto_timer -= 1000;
      const earned = Math.floor(S.auto * S.mult * (cps >= 8 ? 2 : 1) * (S.boost_ms > 0 ? 3 : 1));
      S.score += earned;
      S.t_earn += earned;
      check_ach();
      update_ui();
    }

    // –ö–æ–º–±–æ‚Äë–ª–µ–π–±–ª
    if (cps > 2) {
      combo_lbl.visible = true;
      combo_lbl.text = cps >= 8 ? cps + ' FRENZY x2!' : cps + ' clk/s';
      const j = cps >= 5 ? (Math.random() - 0.5) * cps : 0;
      combo_lbl.position.set(duck.x + j, app.screen.height * 0.12);
      combo_lbl.scale.set(1 + Math.sin(now / 110) * 0.09);
      combo_lbl.style.fill = cps >= 8 ? 0xff3333 : (cps >= 5 ? 0xffa500 : 0xffff00);
    } else {
      combo_lbl.visible = false;
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è —É—Ç–∫–∏ (—Ç—ã–∫, –≤—Ä–∞—â–µ–Ω–∏–µ)
    S.dk_scale += (1 - S.dk_scale) * 0.2 * delta;
    duck.scale.set(S.dk_scale);
    S.dk_rot_vel *= Math.pow(0.88, delta);
    S.dk_rot += S.dk_rot_vel * 0.04 * delta;
    S.dk_rot += -S.dk_rot * 0.1 * delta;
    duck.rotation = S.dk_rot;

    // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
    if (S.shake > 0.2) {
      world.position.set((Math.random() - 0.5) * S.shake, (Math.random() - 0.5) * S.shake);
      S.shake *= Math.pow(0.82, delta);
    } else {
      S.shake = 0;
      world.position.set(0, 0);
    }

    // –°–¥–≤–∏–≥ –º–µ–Ω—é
    menu_cont.x += ((S.menu_open ? 0 : -S.menu_w) - menu_cont.x) * 0.25 * delta;
    const open_left = S.menu_open ? Math.round(menu_cont.x + S.menu_w + 8) : 14;
    document.getElementById('btn_open').style.left = open_left + 'px';

    // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —á–∏—Å–µ–ª (pops)
    for (let i = pops.length - 1; i >= 0; i--) {
      const p = pops[i];
      p.x += p.vx * delta;
      p.y += p.vy * delta;
      p.vy += 0.22 * delta;
      p.l -= 0.022 * delta;
      p.alpha = p.l;
      if (p.l <= 0) { p.destroy(); pops.splice(i, 1); }
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä
    for (let i = sparks.length - 1; i >= 0; i--) {
      const s = sparks[i];
      s.x += s.vx * delta;
      s.y += s.vy * delta;
      s.vy += 0.5 * delta;
      s.l -= 0.032 * delta;
      s.alpha = s.l;
      if (s.l <= 0) { s.destroy(); sparks.splice(i, 1); }
    }

    // –¢–æ—Å—Ç—ã
    for (let i = toasts.length - 1; i >= 0; i--) {
      const t = toasts[i];
      t.ttl -= dt;
      if (t.ttl > 2.5) t.alpha = Math.min(1, (3 - t.ttl) * 6);
      else if (t.ttl < 0.5) t.alpha = Math.max(0, t.ttl * 2);
      if (t.ttl <= 0) { t.destroy(); toast_layer.removeChild(t); toasts.splice(i, 1); }
    }

    // –§–æ–Ω–æ–≤—ã–µ —ç–º–æ–¥–∑–∏ (–¥–≤–∏–∂–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö)
    for (let i = floaters.length - 1; i >= 0; i--) {
      const f = floaters[i];
      f.x += f.vx * delta;
      f.y += f.vy * delta;
      f.rotation += f.rot_v * delta;
      if (f.y < -120) {
        f.y = app.screen.height + 70;
        f.x = Math.random() * app.screen.width;
      }
    }
    while (floaters.length < 18) spawn_floater();

    // –ó–æ–ª–æ—Ç–∞—è —É—Ç–∫–∞
    S.g_ms += ms;
    if (!S.g_active && S.g_ms >= S.g_next) {
      S.g_active = true;
      S.g_ms = 0;
      S.g_next = (30 + Math.random() * 50) * 1000; // —Å–ª–µ–¥—É—é—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª 30‚Äì80 —Å–µ–∫
      const m = 80;
      const W = app.screen.width;
      const H = app.screen.height;
      g_duck.position.set(m + Math.random() * (W - m * 2), m + Math.random() * (H - m * 2));
      g_duck.visible = true;
      g_duck.alpha = 1;
      beep(800, 'sine', 0.3, 0.1);
      show_toast('‚≠ê –ó–æ–ª–æ—Ç–∞—è —É—Ç–∫–∞! –õ–æ–≤–∏!');
    }
    if (S.g_active) {
      const life = 7000;          // –∂–∏–≤—ë—Ç 7 —Å–µ–∫—É–Ω–¥
      const rem = 1 - (S.g_ms / life);
      if (rem <= 0) {
        S.g_active = false;
        g_duck.visible = false;
      } else {
        g_duck.alpha = Math.min(1, rem * 3);
        g_duck.scale.set(0.9 + Math.sin(now / 160) * 0.22);
        g_duck.rotation = Math.sin(now / 380) * 0.35;
        g_duck.x += Math.sin(now / 800) * 0.5 * delta;
        g_duck.y += Math.cos(now / 1100) * 0.4 * delta;
      }
    }
  });

  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  //  –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  load();
  duck.text = loaded_skin;
  if (!unlocked_skins.has(loaded_skin)) {
    unlocked_skins.add(loaded_skin);
    S.skins_n = unlocked_skins.size;
  }
  init_shop();
  init_skins();
  init_stats();
  init_about();
  layout();
  window.addEventListener('resize', layout);

  if (off_gain > 0) setTimeout(() => show_toast('üí§ –ü–æ–∫–∞ –≤–∞—Å –Ω–µ –±—ã–ª–æ: +' + fmt(off_gain) + '!'), 500);
</script>
</body>
</html>